<!-- Pre-owned-vehicle-card - Dark Mode Optimized -->
<style type="text/css">
    /* Dark mode prevention styles */
    @media (prefers-color-scheme: dark) {
        /* Prevent color inversion by specifying dark mode colors */
        .dark-mode-card { background-color: #000000 !important; }
        .dark-mode-text { color: #ffffff !important; }
        .dark-mode-button { background-color: #ffffff !important; }
        .dark-mode-button-text { color: #000000 !important; }
    }
    
    /* Outlook Dark Mode */
    [data-ogsc] .dark-mode-card { background-color: #000000 !important; }
    [data-ogsc] .dark-mode-text { color: #ffffff !important; }
    [data-ogsc] .dark-mode-button { background-color: #ffffff !important; }
    [data-ogsc] .dark-mode-button-text { color: #000000 !important; }
    
    /* Progressive enhancement for modern email clients */
    .rounded-card { border-radius: 8px !important; overflow: hidden !important; }
    .rounded-image { border-radius: 4px !important; }
    .rounded-button { border-radius: 6px !important; }
</style>

<table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td align="center" style="padding: 20px 0;">
            <table width="600" border="0" cellpadding="0" cellspacing="0">
                {% assign product_count = 0 %}
                {% for product in customer.pre-owned-recs limit:9 %}
                    {% if product.Main_Photo %}
                        {% assign product_count = product_count | plus: 1 %}
                    {% endif %}
                {% endfor %}

                {% if product_count > 0 %}
                    {% for product in customer.pre-owned-recs limit:9 %}
                    {% if product.Main_Photo %}
                    {% assign mod = forloop.index | modulo: 3 %}
                    {% if mod == 1 %}<tr>{% endif %}
                        <td width="200" valign="top" align="center">
                            <!-- Pure black background -->
                            <table width="190" border="0" cellpadding="0" cellspacing="0" bgcolor="#000000" class="dark-mode-card rounded-card" style="margin: 0 5px; border: 1px solid #333333; background-color: #000000; border-radius: 8px; overflow: hidden;">
                                <!-- Content -->
                                <tr>
                                    <td style="padding: 15px;">
                                        <!-- Badge -->
                                        <table width="100%" border="0" cellpadding="0" cellspacing="0">
                                            <tr>
                                                <td style="padding-bottom: 10px;">
                                                    <font face="Arial, sans-serif" size="2" color="#fefefe" class="dark-mode-text">
                                                        <b>PRE-OWNED SPECIAL</b>
                                                    </font>
                                                </td>
                                            </tr>
                                        </table>
                                        
                                        <!-- Image with white outline for dark mode -->
                                        <table width="100%" border="0" cellpadding="0" cellspacing="0">
                                            <tr>
                                                <td align="center" style="padding-bottom: 10px;">
                                                    <a href="{{ product.VDP_URL_1 }}" target="_blank">
                                                        <img src="{{ product.Main_Photo }}" width="160" alt="{{ product.vehicle_name }}" border="0" class="rounded-image" style="display: block; border: 1px solid #333333; border-radius: 4px;">
                                                    </a>
                                                </td>
                                            </tr>
                                        </table>
                                        
                                        <!-- Title -->
                                        <table width="100%" border="0" cellpadding="0" cellspacing="0">
                                            <tr>
                                                <td height="70" valign="top" style="padding-bottom: 20px;">
                                                    <font face="Arial, sans-serif" size="3" color="#fefefe" class="dark-mode-text">
                                                        <b>{{ product.Year }} {{ product.Make }}<br>
                                                        {% unless product.Make contains "Mercedes" %}{{ product.Model }} {{ product.Trim }}{% else %}{{ product.Trim }}{% endunless %}</b>
                                                    </font>
                                                </td>
                                            </tr>
                                        </table>
                                        
                                        <!-- Details -->
                                        <table width="100%" border="0" cellpadding="0" cellspacing="0">
                                            <tr>
                                                <td style="padding-bottom: 5px;">
                                                    <font face="Arial, sans-serif" size="2" color="#cccccc" class="dark-mode-text">
                                                        Stock #{{ product.Stock }}
                                                    </font>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="padding-bottom: 20px;">
                                                    <font face="Arial, sans-serif" size="2" color="#cccccc" class="dark-mode-text">
                                                        {{ product.Mileage }} mi
                                                    </font>
                                                </td>
                                            </tr>
                                        </table>
                                        
                                        <!-- Price -->
                                        <table width="100%" border="0" cellpadding="0" cellspacing="0">
                                            <tr>
                                                <td>
                                                    <font face="Arial, sans-serif" size="2" color="#cccccc" class="dark-mode-text">
                                                        YOUR PRICE
                                                    </font>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 5px 0;">
                                                    <font face="Arial, sans-serif" size="5" color="#fefefe" class="dark-mode-text">
                                                        <b>${{ product.Price_Is }}</b>
                                                    </font>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="padding-bottom: 20px;">
                                                    <font face="Arial, sans-serif" size="2" color="#888888" class="dark-mode-text">
                                                        <s>WAS ${{ product.Price_Was }}</s>
                                                    </font>
                                                </td>
                                            </tr>
                                        </table>
                                        
                                        <!-- Button -->
                                        <table width="100%" border="0" cellpadding="0" cellspacing="0">
                                            <tr>
                                                <td align="center" bgcolor="#fefefe" class="dark-mode-button rounded-button" style="padding: 10px; background-color: #fefefe; border-radius: 6px;">
                                                    <a href="{{ product.VDP_URL_1 }}" target="_blank" style="color: #000000; text-decoration: none; display: block;">
                                                        <font face="Arial, sans-serif" size="3" color="#000000" class="dark-mode-button-text">
                                                            <b>Shop Now</b>
                                                        </font>
                                                    </a>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    {% if mod == 0 or forloop.last %}
                        {% if forloop.last and mod != 0 %}
                            {% if mod == 1 %}
                                <td width="200">&nbsp;</td>
                                <td width="200">&nbsp;</td>
                            {% elsif mod == 2 %}
                                <td width="200">&nbsp;</td>
                            {% endif %}
                        {% endif %}
                    </tr>
                    {% if mod == 0 and not forloop.last %}
                    <tr>
                        <td colspan="3" height="20" style="font-size: 1px; line-height: 1px;">&nbsp;</td>
                    </tr>
                    {% endif %}
                    {% endif %}
                    {% endif %}
                    {% endfor %}
                {% else %}
                    <tr>
                        <td align="center" style="padding: 40px 20px;">
                            <font face="Arial, sans-serif" size="3" color="#666666">
                                We're updating our inventory. Please check back soon or contact us for our latest pre-owned vehicles.
                            </font>
                        </td>
                    </tr>
                {% endif %}
            </table>
        </td>
    </tr>
</table>
<!-- End Pre-owned-vehicle-card -->